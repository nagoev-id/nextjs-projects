# Photo Gallery

## Настройка Supabase для работы с загрузкой фотографий

### 1. Создание бакета

1. Войдите в панель управления Supabase
2. Перейдите в раздел "Storage"
3. Нажмите "Create new bucket"
4. Введите имя бакета: `photos`
5. Выберите тип доступа: "Private" (для управления доступом через политики)
6. Нажмите "Create bucket"

### 2. Настройка политик доступа

Выполните следующие SQL-запросы в SQL-редакторе Supabase:

```sql
-- Политика для разрешения загрузки файлов в бакет "photos" авторизованным пользователям
create policy "Allow authenticated users to upload to photos bucket"
    on storage.objects
    for insert
    to authenticated
    with check (bucket_id = 'photos');

-- Политика для разрешения чтения файлов из бакета "photos" всем пользователям
create policy "Allow public read access to photos bucket"
    on storage.objects
    for select
    to public
    using (bucket_id = 'photos');

-- Политика для разрешения обновления файлов в бакете "photos" авторизованным пользователям
create policy "Allow authenticated users to update photos"
    on storage.objects
    for update
    to authenticated
    using (bucket_id = 'photos');

-- Политика для разрешения удаления файлов из бакета "photos" авторизованным пользователям
create policy "Allow authenticated users to delete photos"
    on storage.objects
    for delete
    to authenticated
    using (bucket_id = 'photos');
```

### 3. Проверка настроек

1. Перейдите в раздел "Storage" в панели управления Supabase
2. Выберите бакет "photos"
3. Перейдите на вкладку "Policies"
4. Убедитесь, что все политики созданы и активны

### 4. Возможные проблемы и их решения

#### Проблема: Ошибка "Unauthorized" при загрузке файлов

**Решение:**
1. Убедитесь, что пользователь аутентифицирован
2. Проверьте, что сессия пользователя активна и токен не истек
3. Проверьте консоль браузера на наличие ошибок
4. Проверьте, что в панели управления Supabase созданы все необходимые политики

#### Проблема: Файл загружается, но не отображается

**Решение:**
1. Проверьте, что политика для чтения файлов настроена правильно
2. Убедитесь, что URL файла формируется корректно
3. Проверьте, что файл действительно загружен в бакет (через панель управления Supabase)

#### Проблема: Ошибка при получении публичного URL

**Решение:**
1. Убедитесь, что метод `getPublicUrl` вызывается после успешной загрузки файла
2. Проверьте, что имя бакета указано правильно
3. Проверьте, что имя файла передается корректно

### 5. Дополнительные проверки

Если после применения всех политик загрузка файлов все еще не работает, выполните следующие проверки:

1. **Проверьте RLS (Row Level Security)**: Убедитесь, что RLS включен для таблицы storage.objects
2. **Проверьте права доступа**: Убедитесь, что у пользователя есть права на выполнение операций с бакетом
3. **Проверьте консоль браузера**: Посмотрите ошибки в консоли браузера при попытке загрузки файла
4. **Проверьте сетевые запросы**: Используйте вкладку Network в инструментах разработчика для анализа запросов к Supabase
